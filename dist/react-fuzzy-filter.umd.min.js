!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react")):"function"==typeof define&&define.amd?define("react-fuzzy-filter",["react"],e):t.ReactFuzzyFilter=e(t.React)}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(t){return"function"==typeof t}function n(t){return null!=t&&"object"===("undefined"==typeof t?"undefined":y(t))}function o(){try{return l.apply(this,arguments)}catch(t){return k.errorObject.e=t,k.errorObject}}function s(t){return l=t,o}function i(t){return t.reduce(function(t,e){return t.concat(e instanceof F.UnsubscriptionError?e.errors:e)},[])}function c(t,e,r){if(t){if(t instanceof W.Subscriber)return t;if(t[Y.rxSubscriber])return t[Y.rxSubscriber]()}return t||e||r?new W.Subscriber(t,e,r):new W.Subscriber(q.empty)}function u(){return(new Date).getTime()}function a(e){function r(t,r){var n=r(t);"string"==typeof n&&(t=n),e.next(t)}var n=function(t){function e(){var t,n,o,s;d(this,e);for(var i=arguments.length,c=Array(i),u=0;i>u;u++)c[u]=arguments[u];return n=o=g(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),o.state={value:o.props.initialSearch||""},o.updateValue=_t(r,o.props.debounceTime),o.handleChange=function(t){var e=t.target.value;o.setState({value:e}),o.props.debounceTime>0?o.updateValue(e,o.props.onChange):r(e,o.props.onChange)},s=n,g(o,s)}return _(e,t),m(e,[{key:"componentDidMount",value:function(){r(this.props.initialSearch,this.props.onChange)}},{key:"componentWillReceiveProps",value:function(t){this.updateValue=_t(r,t.debounceTime),t.initialSearch!==this.props.initialSearch&&(r(t.initialSearch,this.props.onChange),this.setState({value:t.initialSearch}))}},{key:"render",value:function(){return f.createElement("input",v({className:this.props.classPrefix+"__input",onChange:this.handleChange,value:this.state.value},this.props.inputProps))}}]),e}(t.Component);return n.displayName="InputFilter",n.propTypes={classPrefix:t.PropTypes.string.isRequired,initialSearch:t.PropTypes.string,inputProps:t.PropTypes.object,onChange:t.PropTypes.func,debounceTime:t.PropTypes.number},n.defaultProps={classPrefix:"react-fuzzy-filter",inputProps:{},onChange:function(){},debounceTime:0},n}function p(e){var r=function(t){function r(){var t,e,n,o;d(this,r);for(var s=arguments.length,i=Array(s),c=0;s>c;c++)i[c]=arguments[c];return e=n=g(this,(t=r.__proto__||Object.getPrototypeOf(r)).call.apply(t,[this].concat(i))),n.state={search:null},o=e,g(n,o)}return _(r,t),m(r,[{key:"componentDidMount",value:function(){var t=this;this.subscription=e.subscribe(function(e){return t.setState({search:e})})}},{key:"componentWillUnmount",value:function(){this.subscription.unsubscribe()}},{key:"prefilterItems",value:function(t){var e=this.props.items;return this.props.prefilters.forEach(function(r){var n=r.regex,o=r.handler,s=t.match(n)||[];t=t.replace(n,"").trim(),s.forEach(function(t){e=o(t,e,gt)})}),{items:e,search:t}}},{key:"filterItems",value:function(){var t=this.prefilterItems(this.state.search||""),e=t.items,r=t.search;if(""===r.trim())return this.props.defaultAllItems?e:[];var n=new gt(e,this.props.fuseConfig);return n.search(r)}},{key:"render",value:function(){var t=this.filterItems();return this.props.children(t)}}]),r}(t.Component);return r.displayName="FilterResults",r.propTypes={children:t.PropTypes.func.isRequired,items:t.PropTypes.array.isRequired,defaultAllItems:t.PropTypes.bool,fuseConfig:t.PropTypes.shape({keys:t.PropTypes.array.isRequired,id:t.PropTypes.string,caseSensitive:t.PropTypes.bool,shouldSort:t.PropTypes.bool,searchFn:t.PropTypes.func,getFn:t.PropTypes.func,sortFn:t.PropTypes.func,location:t.PropTypes.number,threshold:t.PropTypes.number,distance:t.PropTypes.number,maxPatternLength:t.PropTypes.number,verbose:t.PropTypes.bool,tokenize:t.PropTypes.bool,tokenSeparator:t.PropTypes.any}).isRequired,prefilters:t.PropTypes.arrayOf(t.PropTypes.shape({regex:t.PropTypes.any.isRequired,handler:t.PropTypes.func.isRequired}).isRequired).isRequired},r.defaultProps={defaultAllItems:!0,prefilters:[]},r}function h(){var t=new mt;return{InputFilter:a(t),FilterResults:p(t)}}var l,f="default"in t?t["default"]:t,b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},S=e(function(t,e){if(e.root="object"==("undefined"==typeof window?"undefined":y(window))&&window.window===window&&window||"object"==("undefined"==typeof self?"undefined":y(self))&&self.self===self&&self||"object"==y(b)&&b.global===b&&b,!e.root)throw new Error("RxJS could not find any global context (window, self, global)")}),w=r,O={isFunction:w},x=Array.isArray||function(t){return t&&"number"==typeof t.length},P={isArray:x},E=n,T={isObject:E},j={e:{}},k={errorObject:j},M=s,A={tryCatch:M},C=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},L=function(t){function e(e){t.call(this),this.errors=e;var r=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return C(e,t),e}(Error),R=L,F={UnsubscriptionError:R},I=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var r=this,n=r._parent,o=r._parents,s=r._unsubscribe,c=r._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var u=-1,a=o?o.length:0;n;)n.remove(this),n=++u<a&&o[u]||null;if(O.isFunction(s)){var p=A.tryCatch(s).call(this);p===k.errorObject&&(e=!0,t=t||(k.errorObject.e instanceof F.UnsubscriptionError?i(k.errorObject.e.errors):[k.errorObject.e]))}if(P.isArray(c))for(u=-1,a=c.length;++u<a;){var h=c[u];if(T.isObject(h)){var p=A.tryCatch(h.unsubscribe).call(h);if(p===k.errorObject){e=!0,t=t||[];var l=k.errorObject.e;l instanceof F.UnsubscriptionError?t=t.concat(i(l.errors)):t.push(l)}}}if(e)throw new F.UnsubscriptionError(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var r=e;switch("undefined"==typeof e?"undefined":y(e)){case"function":r=new t(e);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;r=new t,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=this._subscriptions||(this._subscriptions=[]);return o.push(r),r._addParent(this),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.prototype._addParent=function(t){var e=this,r=e._parent,n=e._parents;r&&r!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}(),U=I,z={Subscription:U},V={closed:!0,next:function(){},error:function(t){throw t},complete:function(){}},q={empty:V},Y=e(function(t,e){var r=S.root.Symbol;e.rxSubscriber="function"==typeof r&&"function"==typeof r["for"]?r["for"]("rxSubscriber"):"@@rxSubscriber",e.$$rxSubscriber=e.rxSubscriber}),D=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},N=function(t){function e(r,n,o){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=q.empty;break;case 1:if(!r){this.destination=q.empty;break}if("object"===("undefined"==typeof r?"undefined":y(r))){r instanceof e?(this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new K(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new K(this,r,n,o)}}return D(e,t),e.prototype[Y.rxSubscriber]=function(){return this},e.create=function(t,r,n){var o=new e(t,r,n);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this,e=t._parent,r=t._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=r,this},e}(z.Subscription),$=N,K=function(t){function e(e,r,n,o){t.call(this),this._parentSubscriber=e;var s,i=this;O.isFunction(r)?s=r:r&&(s=r.next,n=r.error,o=r.complete,r!==q.empty&&(i=Object.create(r),O.isFunction(i.unsubscribe)&&this.add(i.unsubscribe.bind(i)),i.unsubscribe=this.unsubscribe.bind(this))),this._context=i,this._next=s,this._error=n,this._complete=o}return D(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){if(!this.isStopped){var t=this._parentSubscriber;this._complete?t.syncErrorThrowable?(this.__tryOrSetError(t,this._complete),this.unsubscribe()):(this.__tryOrUnsub(this._complete),this.unsubscribe()):this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(r){throw this.unsubscribe(),r}},e.prototype.__tryOrSetError=function(t,e,r){try{e.call(this._context,r)}catch(n){return t.syncErrorValue=n,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(N),W={Subscriber:$},J=c,B={toSubscriber:J},G=e(function(t,e){function r(t){var e,r=t.Symbol;return"function"==typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}e.getSymbolObservable=r,e.observable=r(S.root),e.$$observable=e.observable}),H=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,o=B.toSubscriber(t,e,r);if(n?n.call(o,this.source):o.add(this._trySubscribe(o)),o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}},t.prototype.forEach=function(t,e){var r=this;if(e||(S.root.Rx&&S.root.Rx.config&&S.root.Rx.config.Promise?e=S.root.Rx.config.Promise:S.root.Promise&&(e=S.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var o;o=r.subscribe(function(e){if(o)try{t(e)}catch(r){n(r),o.unsubscribe()}else t(e)},n,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[G.observable]=function(){return this},t.create=function(e){return new t(e)},t}(),Q=H,X={Observable:Q},Z=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},tt=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return Z(e,t),e}(Error),et=tt,rt={ObjectUnsubscribedError:et},nt=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},ot=function(t){function e(e,r){t.call(this),this.subject=e,this.subscriber=r,this.closed=!1}return nt(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(z.Subscription),st=ot,it={SubjectSubscription:st},ct=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},ut=function(t){function e(e){t.call(this,e),this.destination=e}return ct(e,t),e}(W.Subscriber),at=ut,pt=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return ct(e,t),e.prototype[Y.rxSubscriber]=function(){return new ut(this)},e.prototype.lift=function(t){var e=new lt(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new rt.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;r>o;o++)n[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new rt.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;r>o;o++)n[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new rt.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;e>n;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new rt.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new rt.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),z.Subscription.EMPTY):this.isStopped?(t.complete(),z.Subscription.EMPTY):(this.observers.push(t),new it.SubjectSubscription(this,t))},e.prototype.asObservable=function(){var t=new X.Observable;return t.source=this,t},e.create=function(t,e){return new lt(t,e)},e}(X.Observable),ht=pt,lt=function(t){function e(e,r){t.call(this),this.destination=e,this.source=r}return ct(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){var e=this.source;return e?this.source.subscribe(t):z.Subscription.EMPTY},e}(pt),ft=lt,bt={SubjectSubscriber:at,Subject:ht,AnonymousSubject:ft},yt=b&&b.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},dt=function(t){function e(e){t.call(this),this._value=e}return yt(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new rt.ObjectUnsubscribedError;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(bt.Subject),mt=dt,vt=Date.now||u,_t=function(t,e,r){function n(){var a=vt()-c;e>a&&a>0?o=setTimeout(n,e-a):(o=null,r||(u=t.apply(i,s),o||(i=s=null)))}var o,s,i,c,u;return null==e&&(e=100),function(){i=this,s=arguments,c=vt();var a=r&&!o;return o||(o=setTimeout(n,e)),a&&(u=t.apply(i,s),i=s=null),u}},gt=e(function(t){!function(){function e(){console.log.apply(console,arguments)}function r(t,e){var r;this.list=t,this.options=e=e||{};for(r in i)i.hasOwnProperty(r)&&(this.options[r]="boolean"==typeof i[r]?r in e?e[r]:i[r]:e[r]||i[r])}function n(t,e,r){var s,i,c,u,a,p;if(e){if(c=e.indexOf("."),-1!==c?(s=e.slice(0,c),i=e.slice(c+1)):s=e,u=t[s],null!==u&&void 0!==u)if(i||"string"!=typeof u&&"number"!=typeof u)if(o(u))for(a=0,p=u.length;p>a;a++)n(u[a],i,r);else i&&n(u,i,r);else r.push(u)}else r.push(t);return r}function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function s(t,e){e=e||{},this.options=e,this.options.location=e.location||s.defaultOptions.location,this.options.distance="distance"in e?e.distance:s.defaultOptions.distance,this.options.threshold="threshold"in e?e.threshold:s.defaultOptions.threshold,this.options.maxPatternLength=e.maxPatternLength||s.defaultOptions.maxPatternLength,this.pattern=e.caseSensitive?t:t.toLowerCase(),this.patternLen=t.length,this.patternLen<=this.options.maxPatternLength&&(this.matchmask=1<<this.patternLen-1,this.patternAlphabet=this._calculatePatternAlphabet())}var i={id:null,caseSensitive:!1,include:[],shouldSort:!0,searchFn:s,sortFn:function(t,e){return t.score-e.score},getFn:n,keys:[],verbose:!1,tokenize:!1,matchAllTokens:!1,tokenSeparator:/ +/g,minMatchCharLength:1,findAllMatches:!1};r.VERSION="2.6.2",r.prototype.set=function(t){return this.list=t,t},r.prototype.search=function(t){this.options.verbose&&e("\nSearch term:",t,"\n"),this.pattern=t,this.results=[],this.resultMap={},this._keyMap=null,this._prepareSearchers(),this._startSearch(),this._computeScore(),this._sort();var r=this._format();return r},r.prototype._prepareSearchers=function(){var t=this.options,e=this.pattern,r=t.searchFn,n=e.split(t.tokenSeparator),o=0,s=n.length;if(this.options.tokenize)for(this.tokenSearchers=[];s>o;o++)this.tokenSearchers.push(new r(n[o],t));this.fullSeacher=new r(e,t)},r.prototype._startSearch=function(){var t,e,r,n,o=this.options,s=o.getFn,i=this.list,c=i.length,u=this.options.keys,a=u.length,p=null;if("string"==typeof i[0])for(r=0;c>r;r++)this._analyze("",i[r],r,r);else for(this._keyMap={},r=0;c>r;r++)for(p=i[r],n=0;a>n;n++){if(t=u[n],"string"!=typeof t){if(e=1-t.weight||1,this._keyMap[t.name]={weight:e},t.weight<=0||t.weight>1)throw new Error("Key weight has to be > 0 and <= 1");t=t.name}else this._keyMap[t]={weight:1};this._analyze(t,s(p,t,[]),p,r)}},r.prototype._analyze=function(t,r,n,s){var i,c,u,a,p,h,l,f,b,y,d,m,v,_,g,S=this.options,w=!1;if(void 0!==r&&null!==r){c=[];var O=0;if("string"==typeof r){if(i=r.split(S.tokenSeparator),S.verbose&&e("---------\nKey:",t),this.options.tokenize){for(_=0;_<this.tokenSearchers.length;_++){for(f=this.tokenSearchers[_],S.verbose&&e("Pattern:",f.pattern),b=[],m=!1,g=0;g<i.length;g++){y=i[g],d=f.search(y);var x={};d.isMatch?(x[y]=d.score,w=!0,m=!0,c.push(d.score)):(x[y]=1,this.options.matchAllTokens||c.push(1)),b.push(x)}m&&O++,S.verbose&&e("Token scores:",b)}for(a=c[0],h=c.length,_=1;h>_;_++)a+=c[_];a/=h,S.verbose&&e("Token score average:",a)}l=this.fullSeacher.search(r),S.verbose&&e("Full text score:",l.score),p=l.score,void 0!==a&&(p=(p+a)/2),S.verbose&&e("Score average:",p),v=this.options.tokenize&&this.options.matchAllTokens?O>=this.tokenSearchers.length:!0,S.verbose&&e("Check Matches",v),(w||l.isMatch)&&v&&(u=this.resultMap[s],u?u.output.push({key:t,score:p,matchedIndices:l.matchedIndices}):(this.resultMap[s]={item:n,output:[{key:t,score:p,matchedIndices:l.matchedIndices}]},this.results.push(this.resultMap[s])))}else if(o(r))for(_=0;_<r.length;_++)this._analyze(t,r[_],n,s)}},r.prototype._computeScore=function(){var t,r,n,o,s,i,c,u,a,p=this._keyMap,h=this.results;for(this.options.verbose&&e("\n\nComputing score:\n"),t=0;t<h.length;t++){for(n=0,o=h[t].output,s=o.length,u=1,r=0;s>r;r++)i=o[r].score,c=p?p[o[r].key].weight:1,a=i*c,1!==c?u=Math.min(u,a):(n+=a,o[r].nScore=a);h[t].score=1===u?n/s:u,this.options.verbose&&e(h[t])}},r.prototype._sort=function(){var t=this.options;t.shouldSort&&(t.verbose&&e("\n\nSorting...."),this.results.sort(t.sortFn))},r.prototype._format=function(){var t,r,n,o,s,i=this.options,c=i.getFn,u=[],a=this.results,p=i.include;for(i.verbose&&e("\n\nOutput:\n\n",a),o=i.id?function(t){a[t].item=c(a[t].item,i.id,[])[0]}:function(){},s=function(t){var e,r,n,o,s,i=a[t];if(p.length>0){if(e={item:i.item},-1!==p.indexOf("matches"))for(n=i.output,e.matches=[],r=0;r<n.length;r++)o=n[r],s={indices:o.matchedIndices},o.key&&(s.key=o.key),e.matches.push(s);-1!==p.indexOf("score")&&(e.score=a[t].score)}else e=i.item;return e},r=0,n=a.length;n>r;r++)o(r),t=s(r),u.push(t);return u},s.defaultOptions={location:0,distance:100,threshold:.6,maxPatternLength:32},s.prototype._calculatePatternAlphabet=function(){var t={},e=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]|=1<<this.pattern.length-e-1;return t},s.prototype._bitapScore=function(t,e){var r=t/this.patternLen,n=Math.abs(this.options.location-e);return this.options.distance?r+n/this.options.distance:n?1:r},s.prototype.search=function(t){var e,r,n,o,s,i,c,u,a,p,h,l,f,b,y,d,m,v,_,g,S,w,O,x=this.options;if(t=x.caseSensitive?t:t.toLowerCase(),this.pattern===t)return{isMatch:!0,score:0,matchedIndices:[[0,t.length-1]]};if(this.patternLen>x.maxPatternLength){if(v=t.match(new RegExp(this.pattern.replace(x.tokenSeparator,"|"))),_=!!v)for(S=[],e=0,w=v.length;w>e;e++)O=v[e],S.push([t.indexOf(O),O.length-1]);return{isMatch:_,score:_?.5:1,matchedIndices:S}}for(o=x.findAllMatches,s=x.location,n=t.length,i=x.threshold,c=t.indexOf(this.pattern,s),g=[],e=0;n>e;e++)g[e]=0;for(-1!=c&&(i=Math.min(this._bitapScore(0,c),i),c=t.lastIndexOf(this.pattern,s+this.patternLen),-1!=c&&(i=Math.min(this._bitapScore(0,c),i))),c=-1,d=1,m=[],p=this.patternLen+n,e=0;e<this.patternLen;e++){for(u=0,a=p;a>u;)this._bitapScore(e,s+a)<=i?u=a:p=a,a=Math.floor((p-u)/2+u);for(p=a,h=Math.max(1,s-a+1),l=o?n:Math.min(s+a,n)+this.patternLen,f=Array(l+2),f[l+1]=(1<<e)-1,r=l;r>=h;r--)if(y=this.patternAlphabet[t.charAt(r-1)],y&&(g[r-1]=1),f[r]=0===e?(f[r+1]<<1|1)&y:(f[r+1]<<1|1)&y|((b[r+1]|b[r])<<1|1)|b[r+1],f[r]&this.matchmask&&(d=this._bitapScore(e,r-1),i>=d)){if(i=d,c=r-1,m.push(c),!(c>s))break;h=Math.max(1,2*s-c)}if(this._bitapScore(e+1,s)>i)break;b=f}return S=this._getMatchedIndices(g),{isMatch:c>=0,score:0===d?.001:d,matchedIndices:S}},s.prototype._getMatchedIndices=function(t){for(var e,r=[],n=-1,o=-1,s=0,i=t.length;i>s;s++)e=t[s],e&&-1===n?n=s:e||-1===n||(o=s-1,o-n+1>=this.options.minMatchCharLength&&r.push([n,o]),n=-1);return t[s-1]&&s-1-n+1>=this.options.minMatchCharLength&&r.push([n,s-1]),r},t.exports=r}(b)});return h});